<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Load Django static files -->
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon for the site -->
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Custom CSS styles -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <!-- jQuery UI CSS for datepicker -->
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <!-- Title of the page -->
    <title>Bella Italia - Make a Reservation</title> 
</head>
<body>
    <header id="header">
        <div class="logocontainer">
            <img src="{% static 'images/logo.png' %}" alt="Logo" class="logo">
        </div>
        <nav id="menu">
            <ul>
                <!-- Navigation links -->
                <li><a href="{% url 'index' %}">Home</a></li>
                <li><a href="{% url 'menu' %}">Menu</a></li>
                <li><a href="{% url 'make_reservation' %}">Booking</a></li>
            </ul>
        </nav>
        <!-- Menu button for small screens -->
        <div id="menusmallscreen">
            <button class="menubtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <!-- Side navigation for small screens -->
        <div id="sidenav" class="sidenav">
            <a href="{% url 'index' %}">Home</a>
            <a href="{% url 'menu' %}">Menu</a>
            <a href="{% url 'make_reservation' %}">Booking</a>
        </div>
    </header>
    <section class="container3">
        <h2>Make a Reservation</h2>
        <div class="formcontainer">
            <!-- Reservation form -->
            <form method="post" action="{% url 'make_reservation' %}" class="reservation_form" id="reservationForm">
                <!-- CSRF token for security -->
                {% csrf_token %}
                <!-- Form fields -->
                <div class="fieldWrapper">
                    {{ form.name.label_tag }}
                    {{ form.name }}
                </div>
                <div class="fieldWrapper">
                    {{ form.phone_number.label_tag }}
                    {{ form.phone_number }}
                </div>
                <div class="fieldWrapper">
                    {{ form.guests.label_tag }}
                    {{ form.guests }}
                </div>
                <div class="fieldWrapper">
                    {{ form.date.label_tag }}
                    {{ form.date }}
                </div>
                <div class="fieldWrapper">
                    {{ form.time.label_tag }}
                    {{ form.time }}
                </div>
                <button type="submit">Book</button>
            </form>
        </div>
    </section>
    <footer id="reservation_footer">
        <p>&copy; 2024 Bella Italia</p>
        <nav id="footermenu">
            <ul>
                <!-- Social media links -->
                <li><a href="https://www.instagram.com" target="_blank"><i class="fab fa-instagram"></i>Follow us on Instagram</a></li>
                <li><a href="https://www.facebook.com" target="_blank"><i class="fab fa-facebook"></i>Check out our Facebook</a></li>
            </ul>
        </nav>
    </footer>
    <!-- Scripts -->
    <!-- jQuery library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- jQuery UI library for datepicker -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script>
        $(document).ready(function() {
            var currentYear = new Date().getFullYear();
            var endDate = new Date(currentYear, 11, 31); // Set end date to Dec 31 of current year

            $('#id_date').datepicker({
                dateFormat: 'yy-mm-dd',  // Format for the date
                changeMonth: true,       // Allow changing month
                changeYear: false,       // Disallow changing year
                showButtonPanel: true,   // Show buttons today and done
                minDate: new Date(),     // Set minimum date to today
                maxDate: endDate,        // Set maximum date to end of current year
                beforeShowDay: function(date) {
                    var day = date.getDay();
                    return [(day != 0), '']; // Block Sundays (0 = Sunday)
                },
                onSelect: function(dateText) {
                    $.ajax({
                        url: "{% url 'get_available_times' %}",  // URL to get available times
                        data: {
                            'date': dateText  // Selected date
                        },
                        success: function(data) {
                            var timeSelect = $('#id_time');
                            timeSelect.empty();  // Clear the time dropdown
                            if (data.times.length > 0) {
                                // Populate dropdown with available times
                                $.each(data.times, function(index, value) {
                                    timeSelect.append($('<option>', {
                                        value: value,
                                        text: value
                                    }));
                                });
                            } else {
                                // No available times message
                                timeSelect.append($('<option>', {
                                    value: '',
                                    text: 'No available times for this date'
                                }));
                            }
                        },
                        error: function() {
                            // Error fetching times message
                            var timeSelect = $('#id_time');
                            timeSelect.empty();
                            timeSelect.append($('<option>', {
                                value: '',
                                text: 'Error fetching times. Please try again later.'
                            }));
                        }
                    });
                }
            });

            // Trigger change event on page load to initialize datepicker
            $('#id_date').trigger('change');
        });
    </script>
    <!-- Custom JavaScript file -->
    <script src="{% static 'scripts/script.js' %}"></script>
</body>
</html>
