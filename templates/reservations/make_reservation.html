<!-- bookings/templates/bookings/make_reservation.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{% static 'images/favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <title>Bella Italia - Make a Reservation</title> 
</head>
<body>
    <header id="header">
        <div class="logocontainer">
            <img src="{% static 'images/logo.png' %}" alt="Logo" class="logo">
        </div>
        <nav id="menu">
            <ul>
                <li><a href="{% url 'index' %}">Home</a></li>
                <li><a href="{% url 'menu' %}">Menu</a></li>
                <li><a href="{% url 'make_reservation' %}">Booking</a></li>
            </ul>
        </nav>
        <div id="menusmallscreen">
            <button class="menubtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        <div id="sidenav" class="sidenav">
            <a href="{% url 'index' %}">Home</a>
            <a href="{% url 'menu' %}">Menu</a>
            <a href="{% url 'make_reservation' %}">Booking</a>
        </div>
    </header>
    <section class="container3">
        <h2>Make a Reservation</h2>
        <div class="formcontainer">
            <form method="post" action="{% url 'make_reservation' %}" class="reservation_form" id="reservationForm">
                {% csrf_token %}
                <div class="fieldWrapper">
                    {{ form.name.label_tag }}
                    {{ form.name }}
                </div>
                <div class="fieldWrapper">
                    {{ form.phone_number.label_tag }}
                    {{ form.phone_number }}
                </div>
                <div class="fieldWrapper">
                    {{ form.guests.label_tag }}
                    {{ form.guests }}
                </div>
                <div class="fieldWrapper">
                    {{ form.date.label_tag }}
                    {{ form.date }}
                </div>
                <div class="fieldWrapper">
                    {{ form.time.label_tag }}
                    {{ form.time }}
                </div>
                <button type="submit">Book</button>
            </form>
        </div>
    </section>
    <footer id="reservation_footer">
        <p>&copy; 2024 Bella Italia</p>
        <nav id="footermenu">
            <ul>
                <li><a href="https://www.instagram.com" target="_blank"><i class="fab fa-instagram"></i>Follow us on Instagram</a></li>
                <li><a href="https://www.facebook.com" target="_blank"><i class="fab fa-facebook"></i>Check out our Facebook</a></li>
            </ul>
        </nav>
    </footer>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <script>
        $(document).ready(function() {
            var currentYear = new Date().getFullYear();
            var endDate = new Date(currentYear, 11, 31); // Set end date to Dec 31 of current year

            $('#id_date').datepicker({
                dateFormat: 'yy-mm-dd',
                changeMonth: true,
                changeYear: false,
                showButtonPanel: true,
                minDate: new Date(),
                maxDate: endDate,
                beforeShowDay: function(date) {
                    var day = date.getDay();
                    return [(day != 0), '']; // Block Sundays (0 = Sunday)
                },
                onSelect: function(dateText) {
                    $.ajax({
                        url: "{% url 'get_available_times' %}",
                        data: {
                            'date': dateText
                        },
                        success: function(data) {
                            var timeSelect = $('#id_time');
                            timeSelect.empty();
                            if (data.times.length > 0) {
                                $.each(data.times, function(index, value) {
                                    timeSelect.append($('<option>', {
                                        value: value,
                                        text: value
                                    }));
                                });
                            } else {
                                timeSelect.append($('<option>', {
                                    value: '',
                                    text: 'No available times for this date'
                                }));
                            }
                        },
                        error: function() {
                            var timeSelect = $('#id_time');
                            timeSelect.empty();
                            timeSelect.append($('<option>', {
                                value: '',
                                text: 'Error fetching times. Please try again later.'
                            }));
                        }
                    });
                }
            });

            $('#id_date').trigger('change');
        });
    </script>
    <script src="{% static 'scripts/script.js' %}"></script>
</body>
</html>
